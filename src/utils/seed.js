const Tenant = require("../models/tenant");
const BaseOmie = require("../models/baseOmie");
const Configuracoes = require("../models/configuracao");
const Moeda = require("../models/moeda");
const Template = require("../models/template");
const Include = require("../models/include");

const onDemandBase64 = `/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAAhALUDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9U6jknii++4HtTnAZcE4z3qvLZJKQfNOQMUAKb+AdNx/Cnpd279JAPrxUP9nwqMtI2Pyqs8UW7bFMGPvxn8aAL0044jiYF2447VWkhfcAuxnPJGeR+NVgWicHGCDnmp4mBJ2uAo5+cZ20AXbdmMfzMGxxkUqzKzbcEdsmoTLDbQkK+9j79TUVqzzzKW6RjOfWgC/RRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUARymLH7wjiq8d1bKTgsvbkdasNBGxJYHnrzVd9OUnKSEfUZoAr3G3O6Jy0Z7ehqJAh+++0fTNXYrFlyHkBU9RikbTh/BKR9RQBWVLckZmYD3WrT2iSoPs8o2jt61E+nzKMqyt7VCrS275GVI7GgCZNPlLYYgD1q9FCkK7UH196jjuQVUyKVJHNTA55oACyr95gPqaR3RELs2FHeqL+WbpxdE4/hpiq72zbQSqsCPpQBZ+3x5+4+31xVgSIyhgww3Sqj3MBtdnfbjb71DJGyxQK/GST+BxQBpBlOcMDj0NVvt6ZI8tzio1jWC+SOPIUrkiktZ4oTIJGxk8cUAW4Zo5l3IenUGnhlJwGBP1rOTzCJ5ogQp6fnTUUMEKPGj565Oc0AaRdRnLDjrzS7lGCWHPTmqHlJLeSK/YE8etRxxI9vJIc5TpzQBpllHJIH1o3KRuDDHrms9nRo4VdATjgscAU2IkJOgIK7c8dOtAGjvXj5hz05pSwXliB9azTEgtFnGd5bHWnyFWmj+0E7Cg/lQBM96EkZPLzt75oqmdgdhGflzxmigDWooooAKKKKACoZvvLRRQArfeH1qQdKKKAKeo/wVYg/1K/SiigCgv/H1+NWrz78f1oooAH/4/k/3f8aqN94/WiigDRh/1Q+lUYf+Pr8aKKALEf8Ax9S/Q0yL/j2l+tFFADLj/j3ipU6S/wC5RRQA5/8AjyX/AHv8aS7/ANRH9KKKAI2+8foP5UUUUAf/2Q==`;

const defaultBaseOmie = {
  nome: "oOnDemand Dev",
  cnpj: "11111111111112",
  status: "ativo",
  appKey: "3908593091403",
  appSecret: "a81ce6a9a4d94b84b8b6571cddf39b63",
};

const defaultConfigs = [
  {
    codigo: "enviar-email",
    valor: true,
    baseOmie: null,
  },
  {
    codigo: "email-from",
    valor: "mirian@oondemand.com.br",
    baseOmie: null,
  },
  {
    codigo: "email-from-nome",
    valor: "Apresentação Oondemand",
    baseOmie: null,
  },
  {
    codigo: "omie-etapa-gerar",
    valor: "30",
    baseOmie: null,
  },
  {
    codigo: "omie-etapa-processado",
    valor: "50",
    baseOmie: null,
  },
  {
    codigo: "omie-etapa-erro",
    valor: "20",
    baseOmie: null,
  },
  {
    codigo: "template-email-assunto",
    valor: "email-assunto",
    baseOmie: null,
  },
  {
    codigo: "template-email-corpo",
    valor: "email-corpo",
    baseOmie: null,
  },
  {
    codigo: "template-fatura",
    valor: "fatura",
    baseOmie: null,
  },
  {
    codigo: "email-copia",
    valor: "maikonalexandre574@gmail.com",
    baseOmie: null,
  },
];

const defaultMoedas = [
  {
    tipoCotacao: "valorFixo",
    nome: "Euro",
    simbolo: "EUR",
    valor: 6.55,
  },
  {
    tipoCotacao: "porcentagem",
    valor: 110,
    nome: "Dólar",
    simbolo: "USD",
    status: "ativo",
  },
];

const defaultIncludes = [
  {
    codigo: "logo",
    status: "ativo",
    contenType: "image/png",
    descricao: "Descrição",
    conteudo: onDemandBase64,
  },
  {
    codigo: "Código ",
    descricao: "Descrição",
    contenType: "image/png",
    status: "ativo",
    conteudo: onDemandBase64,
  },
];

const defaultTemplates = [
  {
    descricao: "Descrição",
    templateEjs:
      '<%\nlet dataRps = os.InformacoesAdicionais.dDataRps ? os.InformacoesAdicionais.dDataRps.split("/") : [];\nlet competencia = "";\nif(dataRps?.length > 2) { competencia = `${dataRps[1]}/${dataRps[2]}`; }\n%><%= cliente.razao_social %> - FATURAMENTO/ INVOICING  EUROPARTNER<%= competencia %>',
    status: "ativo",
    codigo: "email-assunto",
    variables:
      '{\n  "os": {\n    "InformacoesAdicionais": {\n      "dDataRps": "15/12/2023"\n    }\n  },\n  "cliente": {\n    "razao_social": "Empresa Exemplo"\n  }\n}\n',
    omieVar:
      '{\n  "os": {\n    "Cabecalho": {\n      "cCodIntCli": "",\n      "cCodIntOS": "",\n      "cCodParc": "999",\n      "cEtapa": "50",\n      "cNumOS": "110",\n      "dDtPrevisao": "18/11/2024",\n      "nCodCli": 4960786653,\n      "nCodOS": 4981825585,\n      "nCodVend": 0,\n      "nQtdeParc": 1,\n      "nValorTotal": 890,\n      "nValorTotalImpRet": 186.6\n    },\n    "InformacoesAdicionais": {\n      "cCidPrestServ": "ARACARIGUAMA (SP)",\n      "cCodART": "",\n      "cCodCateg": "1.01.01",\n      "cCodObra": "teste para enco",\n      "cContato": "",\n      "cDadosAdicNF": "",\n      "cNumContrato": "",\n      "cNumPedido": "",\n      "cNumRecibo": "0",\n      "dDataRps": "",\n      "nCodCC": 4814121437,\n      "nCodProj": 0\n    },\n    "Email": {\n      "cEnvBoleto": "S",\n      "cEnvLink": "N",\n      "cEnvPix": "N",\n      "cEnvRecibo": "N",\n      "cEnvViaUnica": "N",\n      "cEnviarPara": "mirian@gmail.com"\n    },\n    "Departamentos": [\n      {\n        "cCodDepto": "4809215566",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      },\n      {\n        "cCodDepto": "4809215569",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      },\n      {\n        "cCodDepto": "4810206578",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      },\n      {\n        "cCodDepto": "4908335618",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      }\n    ],\n    "ServicosPrestados": [\n      {\n        "cCodCategItem": "1.01.01",\n        "cCodServLC116": "",\n        "cCodServMun": "",\n        "cDadosAdicItem": "",\n        "cDescServ": "Serviços prestados teste",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "S",\n        "cTpDesconto": "P",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "S",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 4,\n          "nAliqCSLL": 6,\n          "nAliqINSS": 2,\n          "nAliqIRRF": 1,\n          "nAliqISS": 5,\n          "nAliqPIS": 3,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 800,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 32,\n          "nValorCSLL": 48,\n          "nValorINSS": 16,\n          "nValorIRRF": 8,\n          "nValorISS": 40,\n          "nValorPIS": 24\n        },\n        "nAliqDesconto": 0,\n        "nCodServico": 0,\n        "nIdItem": 4981825636,\n        "nQtde": 1,\n        "nSeqItem": 1,\n        "nValUnit": 800,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 0,\n        "nValorOutrasRetencoes": 0\n      },\n      {\n        "cCodCategItem": "1.01.01",\n        "cCodServLC116": "",\n        "cCodServMun": "",\n        "cDadosAdicItem": "",\n        "cDescServ": "Serviços prestados",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "S",\n        "cTpDesconto": "",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "S",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 1,\n          "nAliqCSLL": 4,\n          "nAliqINSS": 5,\n          "nAliqIRRF": 2,\n          "nAliqISS": 6,\n          "nAliqPIS": 3,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 85,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 0.9,\n          "nValorCSLL": 3.6,\n          "nValorINSS": 4.5,\n          "nValorIRRF": 1.8,\n          "nValorISS": 5.1,\n          "nValorPIS": 2.7\n        },\n        "nAliqDesconto": 10,\n        "nCodServico": 0,\n        "nIdItem": 4981825637,\n        "nQtde": 5,\n        "nSeqItem": 2,\n        "nValUnit": 20,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 10,\n        "nValorOutrasRetencoes": 0\n      }\n    ],\n    "Parcelas": [\n      {\n        "dDtVenc": "18/12/2024",\n        "nDias": 30,\n        "nParcela": 1,\n        "nPercentual": 100,\n        "nValor": 890,\n        "tipo_documento": "BOL"\n      }\n    ],\n    "Observacoes": {\n      "cObsOS": "Invoice enviada para mirian@gmail.com,mirian@gmail.com,faturamento@europartner.com.br as 11/18/2024, 5:29:30 PM|SyntaxError: Unexpected token &amp;apos;{&amp;apos; while compiling ejs||If the above error is not helpful, you may want to try EJS-Lint:|https://github.com/RyanZim/EJS-Lint|Or, if you meant to create an async function, pass `async: true` as an option."\n    },\n    "InfoCadastro": {\n      "cAmbiente": "",\n      "cCancelada": "N",\n      "cFaturada": "N",\n      "cHrAlt": "14:29:32",\n      "cHrInc": "14:28:43",\n      "dDtAlt": "18/11/2024",\n      "dDtInc": "18/11/2024"\n    },\n    "despesasReembolsaveis": {},\n    "produtosUtilizados": {\n      "cAcaoProdUtilizados": "REM",\n      "cCodCategRem": "1.01.01",\n      "produtoUtilizado": [\n        {\n          "codigo_local_estoque": 4809215579,\n          "nCodProdutoPU": 4905389690,\n          "nIdItemPU": 4981825697,\n          "nQtdePU": 0\n        }\n      ]\n    }\n  },\n  "cliente": {\n    "codigo_cliente_omie": 4960786653,\n    "codigo_cliente_integracao": "3ec48292-98f3-4eb6-b1de-437f6d945f6c",\n    "razao_social": "Microssoft",\n    "cnpj_cpf": "17.895.646/0001-87",\n    "nome_fantasia": "Microssoft",\n    "telefone1_ddd": "",\n    "telefone1_numero": "",\n    "contato": "",\n    "endereco": "Rua Turiacu",\n    "endereco_numero": "15",\n    "bairro": "Parque Industrial",\n    "complemento": "12b",\n    "estado": "SP",\n    "cidade": "SAO JOSE DOS CAMPOS (SP)",\n    "cep": "12235650",\n    "codigo_pais": "1058",\n    "separar_endereco": "",\n    "pesquisar_cep": "",\n    "telefone2_ddd": "",\n    "telefone2_numero": "",\n    "fax_ddd": "",\n    "fax_numero": "",\n    "email": "mirian@oondemand.com.br",\n    "homepage": "",\n    "inscricao_estadual": "",\n    "inscricao_municipal": "",\n    "inscricao_suframa": "",\n    "optante_simples_nacional": "",\n    "tipo_atividade": "",\n    "cnae": "",\n    "produtor_rural": "",\n    "contribuinte": "",\n    "observacao": "",\n    "obs_detalhadas": "",\n    "recomendacao_atraso": "",\n    "tags": [\n      {\n        "tag": "Fornecedor"\n      }\n    ],\n    "pessoa_fisica": "N",\n    "exterior": "N",\n    "logradouro": "",\n    "importado_api": "",\n    "bloqueado": "N",\n    "cidade_ibge": "3549904",\n    "valor_limite_credito": 0,\n    "bloquear_faturamento": "N",\n    "recomendacoes": {\n      "gerar_boletos": "N"\n    },\n    "enderecoEntrega": {},\n    "nif": "",\n    "documento_exterior": "",\n    "inativo": "N",\n    "dadosBancarios": {\n      "agencia": "4500",\n      "cChavePix": "",\n      "codigo_banco": "041",\n      "conta_corrente": "2020-4",\n      "doc_titular": "17.895.646/0001-87",\n      "nome_titular": "Microssoft",\n      "transf_padrao": "N"\n    },\n    "caracteristicas": [],\n    "enviar_anexos": "",\n    "info": {\n      "cImpAPI": "S",\n      "dAlt": "19/11/2024",\n      "dInc": "01/11/2024",\n      "hAlt": "10:56:19",\n      "hInc": "17:13:17",\n      "uAlt": "P000875035",\n      "uInc": "WEBSERVICE"\n    },\n    "bloquear_exclusao": "N",\n    "pais": "Brasil"\n  }\n}',
  },
  {
    descricao: "Descrição",
    templateEjs:
      '<% let logo = includes.find(item => item.codigo === \'logo\').conteudo; %>\n\n<style>\n  body {\n    font-family: "Calibri", sans-serif;\n  }\n</style>\n<div>\n  <img src="data:image/gif;base64,<%= logo %>" />\n</div>\n<br />\n<div>\n  Prezados, Dear All,<br /><br />\n  Espero que este e-mail o encontre bem.<br />\n  Segue em anexo a nossa fatura dos serviços prestados.<br />\n  Caso tenha alguma dúvida, não hesite em nos contatar.\n</div>\n<br />\n<div>\n    I hope this email finds you well.<br />\n    Please, find enclosed our invoice for the services provided.<br />\n    Should you have any questions, do not hesitate to contact us.\n</div>\n<br /><br />\n<span style="color: red; font-weight: bold">Due Date: <%= os.Cabecalho.dDtPrevisao %></span>\n\n<br /><br /><br />\nAtenciosamente, Maikon Alexandre,<br /><br /><br />\n\n<!-- Seção de assinatura removida, apenas o nome é exibido -->\n<span style="font-size: medium; font-weight: bold; color: #5f7f8c">Maikon Alexandre</span>\n\n<hr />\n<p style="color: #333; font-size: x-small">\n  <b>CONFIDENTIALITY WARNING.</b> This message and the information contained in or attached to it are private and confidential and intended exclusively for the addressee.\n  EUROPARTNER Ltda. informs to whom it may receive it in error that it contains privileged information, and its use, copy, reproduction, or distribution is forbidden.\n  If you are not the intended recipient of this E-mail, please notify the sender and delete it from your system.\n</p>',
    status: "ativo",
    codigo: "email-corpo",
    variables:
      '{\n  "os": {\n    "Cabecalho": {\n      "dDtPrevisao": "2025-01-31"\n    }\n  }\n}\n',
    omieVar:
      '{\n  "os": {\n    "Cabecalho": {\n      "cCodIntCli": "",\n      "cCodIntOS": "2",\n      "cCodParc": "000",\n      "cEtapa": "60",\n      "cNumOS": "10",\n      "dDtPrevisao": "27/02/2024",\n      "nCodCli": 1811038079,\n      "nCodOS": 1813247991,\n      "nCodVend": 0,\n      "nQtdeParc": 1,\n      "nValorTotal": 2489.96,\n      "nValorTotalImpRet": 153.12\n    },\n    "InformacoesAdicionais": {\n      "cCidPrestServ": "RIO DE JANEIRO (RJ)",\n      "cCodART": "",\n      "cCodCateg": "1.01.02",\n      "cCodObra": "",\n      "cContato": "",\n      "cDadosAdicNF": "Comments - Comentários - Commentaires:Month - Mês - Mois: 01/2024___________________________________***DADOS PARA PAGAMENTO**Banco: Itau (341)\\t\\tAgência: 8548\\t\\tC/C:\\t36650-2\\t\\tSWIFT: ITAUBRSP\\t\\tIBAN: BR93 6070 1190 0854 8000 0366 502C1",\n      "cNumContrato": "",\n      "cNumPedido": "",\n      "cNumRecibo": "0",\n      "dDataRps": "",\n      "nCodCC": 1813184812,\n      "nCodProj": 0\n    },\n    "Email": {\n      "cEnvBoleto": "N",\n      "cEnvLink": "S",\n      "cEnvPix": "N",\n      "cEnvRecibo": "N",\n      "cEnvViaUnica": "N",\n      "cEnviarPara": "faturamento@europartner.com.br"\n    },\n    "Departamentos": [],\n    "ServicosPrestados": [\n      {\n        "cCodCategItem": "1.01.02",\n        "cCodServLC116": "17.01",\n        "cCodServMun": "17.01.01",\n        "cDadosAdicItem": "",\n        "cDescServ": "Accounting - Serviços Contábeis - Comptabilité",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "N",\n        "cTpDesconto": "",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "N",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 3,\n          "nAliqCSLL": 1,\n          "nAliqINSS": 0,\n          "nAliqIRRF": 1.5,\n          "nAliqISS": 0,\n          "nAliqPIS": 0.65,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 680.03,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 20.4,\n          "nValorCSLL": 6.8,\n          "nValorINSS": 0,\n          "nValorIRRF": 10.2,\n          "nValorISS": 0,\n          "nValorPIS": 4.42\n        },\n        "nAliqDesconto": 0,\n        "nCodServico": 0,\n        "nIdItem": 1813247994,\n        "nQtde": 1,\n        "nSeqItem": 1,\n        "nValUnit": 680.03,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 0,\n        "nValorOutrasRetencoes": 0\n      },\n      {\n        "cCodCategItem": "1.01.02",\n        "cCodServLC116": "17.01",\n        "cCodServMun": "17.01.01",\n        "cDadosAdicItem": "",\n        "cDescServ": "Financial - Financeiro - Financier",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "N",\n        "cTpDesconto": "",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "N",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 3,\n          "nAliqCSLL": 1,\n          "nAliqINSS": 0,\n          "nAliqIRRF": 1.5,\n          "nAliqISS": 0,\n          "nAliqPIS": 0.65,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 188.32,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 5.65,\n          "nValorCSLL": 1.88,\n          "nValorINSS": 0,\n          "nValorIRRF": 2.82,\n          "nValorISS": 0,\n          "nValorPIS": 1.22\n        },\n        "nAliqDesconto": 0,\n        "nCodServico": 0,\n        "nIdItem": 1813247995,\n        "nQtde": 1,\n        "nSeqItem": 2,\n        "nValUnit": 188.32,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 0,\n        "nValorOutrasRetencoes": 0\n      },\n      {\n        "cCodCategItem": "1.01.02",\n        "cCodServLC116": "17.01",\n        "cCodServMun": "17.01.01",\n        "cDadosAdicItem": "",\n        "cDescServ": "Company administration - Administração -  Administration",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "N",\n        "cTpDesconto": "",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "N",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 3,\n          "nAliqCSLL": 1,\n          "nAliqINSS": 0,\n          "nAliqIRRF": 1.5,\n          "nAliqISS": 0,\n          "nAliqPIS": 0.65,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 1360.06,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 40.8,\n          "nValorCSLL": 13.6,\n          "nValorINSS": 0,\n          "nValorIRRF": 20.4,\n          "nValorISS": 0,\n          "nValorPIS": 8.84\n        },\n        "nAliqDesconto": 0,\n        "nCodServico": 0,\n        "nIdItem": 1813247996,\n        "nQtde": 1,\n        "nSeqItem": 3,\n        "nValUnit": 1360.06,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 0,\n        "nValorOutrasRetencoes": 0\n      },\n      {\n        "cCodCategItem": "1.01.02",\n        "cCodServLC116": "17.01",\n        "cCodServMun": "17.01.01",\n        "cDadosAdicItem": "",\n        "cDescServ": "Legal residence - Domiciliação Fiscal - Domiciliation fiscale",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "N",\n        "cTpDesconto": "",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "N",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 3,\n          "nAliqCSLL": 1,\n          "nAliqINSS": 0,\n          "nAliqIRRF": 1.5,\n          "nAliqISS": 0,\n          "nAliqPIS": 0.65,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 261.55,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 7.85,\n          "nValorCSLL": 2.62,\n          "nValorINSS": 0,\n          "nValorIRRF": 3.92,\n          "nValorISS": 0,\n          "nValorPIS": 1.7\n        },\n        "nAliqDesconto": 0,\n        "nCodServico": 0,\n        "nIdItem": 1813247997,\n        "nQtde": 1,\n        "nSeqItem": 4,\n        "nValUnit": 261.55,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 0,\n        "nValorOutrasRetencoes": 0\n      }\n    ],\n    "Parcelas": [\n      {\n        "dDtVenc": "27/02/2024",\n        "nDias": 0,\n        "nParcela": 1,\n        "nPercentual": 100,\n        "nValor": 2489.96\n      }\n    ],\n    "Observacoes": {\n      "cObsOS": "Ordem de serviço importada automaticamente em 21/02/2024 às 08:33.|Ordem de serviço importada automaticamente em 21/02/2024 às 08:33.|Ordem de serviço importada automaticamente em 21/02/2024 às 08:33.|Ordem de serviço importada automaticamente em 21/02/2024 às 08:33."\n    },\n    "InfoCadastro": {\n      "cAmbiente": "P",\n      "cCancelada": "N",\n      "cFaturada": "S",\n      "cHrAlt": "08:54:42",\n      "cHrFat": "08:54:41",\n      "cHrInc": "08:33:30",\n      "dDtAlt": "21/02/2024",\n      "dDtFat": "21/02/2024",\n      "dDtInc": "21/02/2024"\n    },\n    "despesasReembolsaveis": {},\n    "produtosUtilizados": {}\n  },\n  "cliente": {\n    "codigo_cliente_omie": 1811038079,\n    "codigo_cliente_integracao": "",\n    "razao_social": "CAFIRIO INVESTIMENTOS E PARTICIPACOES LTDA.",\n    "cnpj_cpf": "15.100.832/0001-57",\n    "nome_fantasia": "CAFIRIO INVESTIMENTOS E PARTICIPACOES LTDA.",\n    "telefone1_ddd": "",\n    "telefone1_numero": "",\n    "contato": "",\n    "endereco": "AVENIDA GRACA ARANHA",\n    "endereco_numero": "00019",\n    "bairro": "CENTRO",\n    "complemento": "GRP 804",\n    "estado": "RJ",\n    "cidade": "RIO DE JANEIRO (RJ)",\n    "cep": "20030002",\n    "codigo_pais": "1058",\n    "separar_endereco": "",\n    "pesquisar_cep": "",\n    "telefone2_ddd": "",\n    "telefone2_numero": "",\n    "fax_ddd": "",\n    "fax_numero": "",\n    "email": "jacques.carsantier@aryesgroup.fr,assistente2@europartner.com.br,bpofinanceiro1@europartner.com.br",\n    "homepage": "",\n    "inscricao_estadual": "",\n    "inscricao_municipal": "",\n    "inscricao_suframa": "",\n    "optante_simples_nacional": "",\n    "tipo_atividade": "2",\n    "cnae": "6810201",\n    "produtor_rural": "",\n    "contribuinte": "",\n    "observacao": "",\n    "obs_detalhadas": "",\n    "recomendacao_atraso": "",\n    "tags": [\n      {\n        "tag": "Cliente"\n      }\n    ],\n    "pessoa_fisica": "N",\n    "exterior": "N",\n    "logradouro": "",\n    "importado_api": "",\n    "bloqueado": "N",\n    "cidade_ibge": "3304557",\n    "valor_limite_credito": 0,\n    "bloquear_faturamento": "N",\n    "recomendacoes": {\n      "gerar_boletos": "N",\n      "tipo_assinante": "6"\n    },\n    "enderecoEntrega": {},\n    "nif": "",\n    "documento_exterior": "",\n    "inativo": "N",\n    "dadosBancarios": {\n      "agencia": "",\n      "cChavePix": "",\n      "codigo_banco": "",\n      "conta_corrente": "",\n      "doc_titular": "",\n      "nome_titular": "",\n      "transf_padrao": "N"\n    },\n    "caracteristicas": [],\n    "enviar_anexos": "",\n    "info": {\n      "cImpAPI": "N",\n      "dAlt": "02/12/2024",\n      "dInc": "08/02/2024",\n      "hAlt": "16:53:46",\n      "hInc": "15:04:38",\n      "uAlt": "P000643434",\n      "uInc": "P000643571"\n    },\n    "bloquear_exclusao": "",\n    "pais": "Brasil"\n  }\n}',
  },
  {
    descricao: "Fatura padrão",
    templateEjs:
      '<%\nlet idiomaFormatado = \'pt-BR\'; \n\nlet logo = includes.find(item => item.codigo === \'logo\').conteudo; \n\nvar cotacaoUSD = moedas.find(moeda => moeda.simbolo === \'USD\')?.valorFinal;\nvar cotacaoEUR = moedas.find(moeda => moeda.simbolo === \'EUR\')?.valorFinal;\n\nconst enderecoLinha1 = configuracoes.find(c => c.codigo === \'endereco-linha1\')?.valor;\nconst enderecoLinha2 = configuracoes.find(c => c.codigo === \'endereco-linha2\')?.valor;\nconst cidade = configuracoes.find(c => c.codigo === \'cidade\')?.valor;\n\nlet partesData = os.InfoCadastro.dDtInc.split(\'/\'); \nlet data = new Date(partesData[2], partesData[1] - 1, partesData[0]); \nlet opcoesExtenso = {year: \'numeric\', month: \'long\', day: \'numeric\' }; \nlet dataEmissao = data.toLocaleDateString(idiomaFormatado, opcoesExtenso); \n\nlet dataRps = os.InformacoesAdicionais.dDataRps ? os.InformacoesAdicionais.dDataRps.split("/") : [];\nlet competencia = ""; \nif(dataRps?.length > 2) { competencia = `${dataRps[1]}/${dataRps[2]}`; } \n\nlet subtotalServicos = 0;\nlet totalDescontos = 0;\n\nlet totalCOFINS = 0;\nlet totalCSLL = 0;\nlet totalIRRF = 0;\nlet totalPIS = 0;\nlet totalImpostos = 0;\n\nos.ServicosPrestados.filter(item => item.cReembolso === \'N\').forEach((item, index) => {\n  subtotalServicos += (item.nValUnit * item.nQtde);\n  if (item.nValorDesconto && !isNaN(item.nValorDesconto)) {\n    totalDescontos += item.nValorDesconto;\n  }\n\n  if (item.impostos) {\n    totalCOFINS += item.impostos.cRetemCOFINS === "S" ? item.impostos.nValorCOFINS : 0;\n    totalCSLL += item.impostos.cRetemCSLL === "S" ? item.impostos.nValorCSLL : 0;\n    totalIRRF += item.impostos.cRetemIRRF === "S" ? item.impostos.nValorIRRF : 0;\n    totalPIS += item.impostos.cRetemPIS === "S" ? item.impostos.nValorPIS : 0;\n  }  \n});\ntotalImpostos = totalCOFINS + totalCSLL + totalIRRF + totalPIS;\n\nlet subtotalReembolsos = 0; \nos.despesasReembolsaveis?.despesaReembolsavel?.forEach((item, index) => { \n  subtotalReembolsos += item.nValorReemb; \n});\n\nvar valorTotal = os.Cabecalho.nValorTotal - totalImpostos;\n\nvar campoObservacoes = os.Observacoes.cObsOS.replace(/;/g, \'<br />\'); \ncampoObservacoes = campoObservacoes.replace(/\\|/g, \'\'); \n\nvar match = campoObservacoes.match(/\\[\\[(.*?)\\]\\]/); \nvar observacoes = "";\nif (match) { \n  observacoes = match[1]; \n}\n\nconst banco = configuracoes.find(c => c.codigo === "pagamento-banco")?.valor;\nconst agencia = configuracoes.find(c => c.codigo === "pagamento-agencia")?.valor;\nconst contaCorrente = configuracoes.find(c => c.codigo === "pagamento-cc")?.valor;\nconst swift = configuracoes.find(c => c.codigo === "pagamento-swift")?.valor;\nconst iban = configuracoes.find(c => c.codigo === "pagamento-iban")?.valor;\n%>\n\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>Fatura | Invoice #<%= os.Cabecalho.cNumOS %></title>\n    <style>\n      body {\n        font-family: Arial, Helvetica, sans-serif;\n        word-wrap: break-word;\n      }\n\n      .container {\n        width: calc(900px - 4rem);\n        padding: 1rem 4rem;\n        margin: auto;\n      }\n\n      h1,\n      h2,\n      h3,\n      h4,\n      h5,\n      h6,\n      p,\n      pre {\n        margin: 0;\n      }\n\n      .titulo {\n        background-color: #009999;\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n        padding: 8px;\n        text-align: cener;\n      }\n\n      .white-border,\n      .white-border th,\n      .white-border td {\n        border: 1px solid #fff;\n        border-collapse: collapse;\n      }\n\n      .no-border {\n        border: none;\n        background-color: transparent;\n      }\n\n      table {\n        width: 100%;\n        margin-bottom: 20px;\n        border-collapse: collapse;\n      }\n\n      th {\n        background-color: #009999;\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n        text-align: center;\n        padding: 4px;\n      }\n\n      td {\n        color: #1e1e1e;\n        font-size: 13px;\n        font-weight: 400;\n        padding: 4px;\n        text-align: center;\n        vertical-align: top;\n      }\n\n      .right {\n        text-align: right;\n      }\n\n      .semibold {\n        font-weight: 700;\n      }\n\n      .comments {\n        color: black;\n        font-size: 13px;\n        font-weight: 600;\n      }\n\n      .details {\n        font-size: 12px;\n        font-weight: 500;\n        color: black;\n        text-align: left;\n        padding-top: 4px;\n        padding-bottom: 4px;\n      }\n\n      .header-logo {\n        width: 50%;\n        text-align: left;\n      }\n\n      .header-title {\n        width: 50%;\n        text-align: right;\n        font-size: 14px;\n        font-weight: 600;\n        color: white;\n      }\n\n      .total {\n        font-size: 16px;\n        font-weight: 700;\n        color: #1e1e1e;\n      }\n\n      .subtotal {\n        font-size: 14px;\n        font-weight: 700;\n        color: #1e1e1e;\n      }\n\n      .nowrap {\n        white-space: nowrap;\n      }\n\n      .bg-light {\n        background-color: #efffff;\n      }\n\n      .bg-cell {\n        background-color: #efffff;\n      }\n\n      .text-left {\n        text-align: left;\n      }\n\n      .margin-bottom-10 {\n        margin-bottom: 10px;\n      }\n\n      .padding-bottom-20 {\n        padding-bottom: 20px;\n      }\n\n      .text-center {\n        text-align: center;\n      }\n\n      .text-right {\n        text-align: right;\n      }\n\n      /* Adjusted styles for the payment section */\n      .payment-table {\n        width: 50%;\n        border-collapse: collapse;\n      }\n\n      .payment-table th {\n        background-color: #009999;\n        color: white;\n        font-size: 14px;\n        font-weight: 600;\n        text-align: left;\n        padding: 8px;\n        border: 1px solid #fff;\n      }\n\n      .payment-table td {\n        color: #1e1e1e;\n        font-size: 12px;\n        font-weight: 600;\n        padding: 4px;\n        text-align: left;\n        border: 1px solid #fff;\n      }\n\n      .payment-table .right {\n        text-align: right;\n      }\n\n      .payment-table .bg-cell {\n        background-color: #efffff;\n      }\n    </style>\n  </head>\n  <body>\n    <div class="container">\n      <!-- Header -->\n      <table>\n        <tr>\n          <td class="header-logo"><img src="data:image/gif;base64,<%= logo %>" /></td>\n          <td>\n            <div class="titulo" style="justify-content: center; align-items: center; margin-top: 20px;">\n              FATURA | INVOICE #<%= os.Cabecalho.cNumOS %>\n            </div>\n          </td>\n        </tr>\n      </table>\n\n      <!-- Company Details -->\n      <table class="margin-bottom-10" style="margin-bottom: 40px;">\n        <tr>\n          <td class="details" style="width: 50%;">\n            <div  style="font-weight: 700; font-size: 16px; margin-bottom: 10px;">\n                <%= baseOmie.nome %>\n            </div>\n            <div>\n                CNPJ: <%= baseOmie.cnpj %><br>\n                <%= enderecoLinha1 %><br>\n                <%= enderecoLinha2 %><br>\n            </div>\n          </td>\n          <td class="details" style="padding-top: 50px;">\n            <div  style="font-weight: 700; font-size: 16px; margin-bottom: 10px;">\n                <%= cliente.nome_fantasia %>\n            </div>\n            <div>\n              <% if (cliente.endereco && cliente.codigo_pais == "1058") { %>\n                    CNPJ/CPF: <%= cliente.cnpj_cpf %><br>\n                    <%= cliente.endereco %>, <%= cliente.endereco_numero %> - <%= cliente.bairro %><br>\n                    <%= cliente.cidade %> - <%= cliente.pais %>\n                <% } else if (cliente.endereco) { %>\n                    <%= cliente.pais %>\n                <% } %>\n            </td>\n        </tr>\n      </table>\n\n      <!-- Date -->\n      <div class="details padding-bottom-20"><%= cidade %>, <%= dataEmissao %></div>\n\n        <table class="white-border">\n    \n          <tr>\n            <th style="width: 5%">#</th>\n            <th style="width: 60%" class="text-left">SERVIÇOS - <%= competencia %></th>\n            <th style="width: 10%">QTD.</th>\n            <th style="width: 15%">VAL. UNIT.</th>\n            <th style="width: 10%">VAL.</th>\n          </tr>\n        \n          <% os.ServicosPrestados.filter(item => item.cReembolso === \'N\').forEach((item, index) => { %>\n            <tr class="bg-light">\n              <td class="text-center"><%= index + 1 %></td>\n              <td class="text-left"><%= item.cDescServ %></td>\n              <td><%= item.nQtde %></td>\n              <td class="nowrap">R$ <%= item.nValUnit.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n              <td class="nowrap" style="text-align: right;">R$ <%= (item.nValUnit * item.nQtde).toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n            </tr>\n          <% }); %>\n        \n        <tfoot>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right no-border subtotal">Subtotal em BRL</td>\n            <td class="no-border subtotal nowrap" style="text-align: right;">R$ <%= subtotalServicos.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <tr>\n            <td colspan="5" class="no-border"></td>\n          </tr>\n      \n          <!-- Taxes -->\n          <% if(totalImpostos > 0 && cliente.codigo_pais == "1058") { %>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right bg-cell">COFINS</td>\n            <td class="nowrap bg-cell" style="text-align: right;">- R$ <%= totalCOFINS.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right bg-cell">CSLL</td>\n            <td class="nowrap bg-cell" style="text-align: right;">- R$ <%= totalCSLL.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right bg-cell">IRRF</td>\n            <td class="nowrap bg-cell" style="text-align: right;">- R$ <%= totalIRRF.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right bg-cell">PIS</td>\n            <td class="nowrap bg-cell" style="text-align: right;">- R$ <%= totalPIS.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right subtotal">Total Impostos</td>\n            <td class="subtotal nowrap" style="text-align: right;">- R$ <%= totalImpostos.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <% } %>\n      \n          <tr>\n            <td colspan="5" class="no-border"></td>\n          </tr>\n          <!-- Reimbursable Expenses -->\n          <% if(subtotalReembolsos > 0) { %>\n            <tr>\n              <th>#</th>\n              <th colspan="3" class="text-left">DESPESA REEMBOLSÁVEL</th>\n              <th>VALOR</th>\n            </tr>\n          \n          \n            <% os.despesasReembolsaveis?.despesaReembolsavel?.forEach((item, index) => { %>\n            <tr class="bg-light">\n              <td><%= index + 1 %></td>\n              <td colspan="3" class="text-left"><%= item.cDescReemb %></td>\n              <td class="nowrap" style="text-align: right;">R$ <%= item.nValorReemb.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n            </tr>\n            <% }); %>\n          \n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right no-border subtotal">Total Despesas</td>\n            <td class="no-border subtotal nowrap" style="text-align: right;">R$ <%= subtotalReembolsos.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>\n          </tr>\n          <% } %>\n      \n          <tr>\n            <td colspan="5" class="no-border"></td>\n          </tr>\n          <!-- Totals -->\n          <% if(totalDescontos > 0) { %>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right no-border total">Descontos</td>\n            <td class="no-border total nowrap" style="text-align: right;">\n              - R$ <%= totalDescontos.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>\n            </td>\n          </tr>\n          <% } %>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right no-border total">Total em BRL</td>\n            <td class="no-border total nowrap" style="text-align: right;">\n              R$ <%= valorTotal.toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>\n            </td>\n          </tr>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right no-border">Total em USD</td>\n            <td class="no-border nowrap" style="text-align: right;">\n              $ <%= (valorTotal / cotacaoUSD).toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>\n            </td>\n          </tr>\n          <tr>\n            <td colspan="2" class="no-border"></td>\n            <td colspan="2" class="right no-border">Total em EUR</td>\n            <td class="no-border nowrap" style="text-align: right;">\n              € <%= (valorTotal / cotacaoEUR).toLocaleString(idiomaFormatado, { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %>\n            </td>\n          </tr>\n        </tfoot>\n      </table>\n\n      <!-- Comments -->\n      <% if(observacoes && observacoes.trim() !== "") { %>\n      <div class="comments">\n          <p style="font-weight: 600;">Comentários/Comments</p>\n          <div style="font-size: 13px; font-weight: 400;">\n              <%- observacoes %>\n          </div>\n      </div>\n      <% } %>\n\n      <!-- Payment Info -->\n      <table class="white-border payment-table" style="margin-top: 10px;">\n        <thead>\n          <tr>\n            <th colspan="2" class="text-left">DADOS DE PAGAMENTO</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr class="bg-light">\n            <td class="right">Due date</td>\n            <td><%= os.Cabecalho.dDtPrevisao %></td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">Type of payment</td>\n            <td>Domestic/International Transfer</td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">Bank</td>\n            <td><%= banco %></td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">Agency</td>\n            <td><%= agencia %></td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">C/C</td>\n            <td><%= contaCorrente %></td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">SWIFT</td>\n            <td><%= swift %></td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">IBAN</td>\n            <td><%= iban  %></td>\n          </tr>\n          <tr class="bg-light">\n            <td class="right">PIX</td>\n            <td><%= baseOmie.cnpj %></td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </body>\n</html>\n',
    status: "ativo",
    codigo: "fatura",
    variables:
      '{\n  "os": {\n    "Cabecalho": {\n      "cNumOS": "12345",\n      "dDtPrevisao": "2025-01-15",\n      "nValorTotal": 1000.00\n    },\n    "InfoCadastro": {\n      "dDtInc": "06/01/2025"\n    },\n    "InformacoesAdicionais": {\n      "dDataRps": "12/2024"\n    },\n    "ServicosPrestados": [\n      {\n        "cReembolso": "N",\n        "nValUnit": 250.00,\n        "nQtde": 2,\n        "nValorDesconto": 0,\n        "impostos": {\n          "cRetemCOFINS": "S",\n          "nValorCOFINS": 10.00,\n          "cRetemCSLL": "S",\n          "nValorCSLL": 5.00,\n          "cRetemIRRF": "S",\n          "nValorIRRF": 7.50,\n          "cRetemPIS": "S",\n          "nValorPIS": 2.50\n        },\n        "cDescServ": "Consultoria"\n      },\n      {\n        "cReembolso": "N",\n        "nValUnit": 300.00,\n        "nQtde": 1,\n        "nValorDesconto": 20.00,\n        "impostos": {\n          "cRetemCOFINS": "S",\n          "nValorCOFINS": 15.00,\n          "cRetemCSLL": "S",\n          "nValorCSLL": 7.50,\n          "cRetemIRRF": "S",\n          "nValorIRRF": 10.00,\n          "cRetemPIS": "S",\n          "nValorPIS": 5.00\n        },\n        "cDescServ": "Desenvolvimento de Sistema"\n      }\n    ],\n    "despesasReembolsaveis": {\n      "despesaReembolsavel": [\n        {\n          "cDescReemb": "Deslocamento",\n          "nValorReemb": 100.00\n        },\n        {\n          "cDescReemb": "Material",\n          "nValorReemb": 50.00\n        }\n      ]\n    },\n    "Observacoes": {\n      "cObsOS": "Fatura válida até [[30/01/2025]]"\n    }\n  },\n  "baseOmie": {\n    "nome": "Europartner",\n    "cnpj": "12.345.678/0001-90"\n  },\n  "cliente": {\n    "nome_fantasia": "Cliente Exemplo",\n    "endereco": "Rua Exemplo, 123",\n    "endereco_numero": "123",\n    "bairro": "Centro",\n    "cidade": "São Paulo",\n    "pais": "Brasil",\n    "codigo_pais": "1058",\n    "cnpj_cpf": "123.456.789-00"\n  },\n  "configuracoes": [\n    {\n      "codigo": "endereco-linha1",\n      "valor": "Av. Paulista, 1000"\n    },\n    {\n      "codigo": "endereco-linha2",\n      "valor": "São Paulo - SP"\n    },\n    {\n      "codigo": "cidade",\n      "valor": "São Paulo"\n    },\n    {\n      "codigo": "pagamento-banco",\n      "valor": "Banco do Brasil"\n    },\n    {\n      "codigo": "pagamento-agencia",\n      "valor": "1234"\n    },\n    {\n      "codigo": "pagamento-cc",\n      "valor": "56789-0"\n    },\n    {\n      "codigo": "pagamento-swift",\n      "valor": "BBBRBRRXXXX"\n    },\n    {\n      "codigo": "pagamento-iban",\n      "valor": "BR12BBBR12345678901234567890"\n    }\n  ],\n  "moedas": [\n    {\n      "simbolo": "USD",\n      "valorFinal": 5.30\n    },\n    {\n      "simbolo": "EUR",\n      "valorFinal": 5.90\n    }\n  ]\n}\n',
    omieVar:
      '{\n  "os": {\n    "Cabecalho": {\n      "cCodIntCli": "",\n      "cCodIntOS": "",\n      "cCodParc": "999",\n      "cEtapa": "50",\n      "cNumOS": "101",\n      "dDtPrevisao": "18/11/2024",\n      "nCodCli": 4927954939,\n      "nCodOS": 4981723490,\n      "nCodVend": 0,\n      "nQtdeParc": 1,\n      "nValorTotal": 890,\n      "nValorTotalImpRet": 186.6\n    },\n    "InformacoesAdicionais": {\n      "cCidPrestServ": "ARACARIGUAMA (SP)",\n      "cCodART": "",\n      "cCodCateg": "1.01.01",\n      "cCodObra": "teste para enco",\n      "cContato": "",\n      "cDadosAdicNF": "",\n      "cNumContrato": "",\n      "cNumPedido": "",\n      "cNumRecibo": "0",\n      "dDataRps": "",\n      "nCodCC": 4814121437,\n      "nCodProj": 0\n    },\n    "Email": {\n      "cEnvBoleto": "S",\n      "cEnvLink": "N",\n      "cEnvPix": "N",\n      "cEnvRecibo": "N",\n      "cEnvViaUnica": "N",\n      "cEnviarPara": "mirian@oondemand.com.br"\n    },\n    "Departamentos": [\n      {\n        "cCodDepto": "4809215566",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      },\n      {\n        "cCodDepto": "4809215569",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      },\n      {\n        "cCodDepto": "4810206578",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      },\n      {\n        "cCodDepto": "4908335618",\n        "nPerc": 25,\n        "nValor": 222.5,\n        "nValorFixo": "N"\n      }\n    ],\n    "ServicosPrestados": [\n      {\n        "cCodCategItem": "1.01.01",\n        "cCodServLC116": "",\n        "cCodServMun": "",\n        "cDadosAdicItem": "",\n        "cDescServ": "Serviços prestados teste",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "S",\n        "cTpDesconto": "P",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "S",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 4,\n          "nAliqCSLL": 6,\n          "nAliqINSS": 2,\n          "nAliqIRRF": 1,\n          "nAliqISS": 5,\n          "nAliqPIS": 3,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 800,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 32,\n          "nValorCSLL": 48,\n          "nValorINSS": 16,\n          "nValorIRRF": 8,\n          "nValorISS": 40,\n          "nValorPIS": 24\n        },\n        "nAliqDesconto": 0,\n        "nCodServico": 0,\n        "nIdItem": 4981723491,\n        "nQtde": 1,\n        "nSeqItem": 1,\n        "nValUnit": 800,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 0,\n        "nValorOutrasRetencoes": 0\n      },\n      {\n        "cCodCategItem": "1.01.01",\n        "cCodServLC116": "",\n        "cCodServMun": "",\n        "cDadosAdicItem": "",\n        "cDescServ": "Serviços prestados",\n        "cNaoGerarFinanceiro": "N",\n        "cReembolso": "N",\n        "cRetemISS": "S",\n        "cTpDesconto": "",\n        "cTribServ": "01",\n        "impostos": {\n          "cFixarCOFINS": "S",\n          "cFixarCSLL": "S",\n          "cFixarINSS": "S",\n          "cFixarIRRF": "S",\n          "cFixarISS": "S",\n          "cFixarPIS": "S",\n          "cRetemCOFINS": "S",\n          "cRetemCSLL": "S",\n          "cRetemINSS": "S",\n          "cRetemIRRF": "S",\n          "cRetemPIS": "S",\n          "lDeduzISS": false,\n          "nAliqCOFINS": 1,\n          "nAliqCSLL": 4,\n          "nAliqINSS": 5,\n          "nAliqIRRF": 2,\n          "nAliqISS": 6,\n          "nAliqPIS": 3,\n          "nAliqRedBaseCOFINS": 0,\n          "nAliqRedBaseINSS": 0,\n          "nAliqRedBasePIS": 0,\n          "nBaseISS": 85,\n          "nTotDeducao": 0,\n          "nValorCOFINS": 0.9,\n          "nValorCSLL": 3.6,\n          "nValorINSS": 4.5,\n          "nValorIRRF": 1.8,\n          "nValorISS": 5.1,\n          "nValorPIS": 2.7\n        },\n        "nAliqDesconto": 10,\n        "nCodServico": 0,\n        "nIdItem": 4981723493,\n        "nQtde": 5,\n        "nSeqItem": 2,\n        "nValUnit": 20,\n        "nValorAcrescimos": 0,\n        "nValorDesconto": 10,\n        "nValorOutrasRetencoes": 0\n      }\n    ],\n    "Parcelas": [\n      {\n        "dDtVenc": "18/12/2024",\n        "nDias": 30,\n        "nParcela": 1,\n        "nPercentual": 100,\n        "nValor": 890,\n        "tipo_documento": "BOL"\n      }\n    ],\n    "Observacoes": {\n      "cObsOS": "Invoice enviada para mirian@oondemand.com.br,mirian@oondemand.com.br,faturamento@europartner.com.br as 11/18/2024, 5:08:34 PM|SyntaxError: Unexpected token &amp;apos;{&amp;apos; while compiling ejs||If the above error is not helpful, you may want to try EJS-Lint:|https://github.com/RyanZim/EJS-Lint|Or, if you meant to create an async function, pass `async: true` as an option."\n    },\n    "InfoCadastro": {\n      "cAmbiente": "",\n      "cCancelada": "N",\n      "cFaturada": "N",\n      "cHrAlt": "14:08:35",\n      "cHrInc": "14:06:07",\n      "dDtAlt": "18/11/2024",\n      "dDtInc": "18/11/2024"\n    },\n    "despesasReembolsaveis": {},\n    "produtosUtilizados": {\n      "cAcaoProdUtilizados": "REM",\n      "cCodCategRem": "1.01.01",\n      "produtoUtilizado": [\n        {\n          "codigo_local_estoque": 4809215579,\n          "nCodProdutoPU": 4905389690,\n          "nIdItemPU": 4981723494,\n          "nQtdePU": 0\n        }\n      ]\n    }\n  },\n  "cliente": {\n    "codigo_cliente_omie": 4927954939,\n    "codigo_cliente_integracao": "524ed6ce-8b6d-4a3e-8dd2-d567ecd13994",\n    "razao_social": "Empresa Teste",\n    "cnpj_cpf": "",\n    "nome_fantasia": "Empresa Teste",\n    "telefone1_ddd": "",\n    "telefone1_numero": "",\n    "contato": "",\n    "endereco": "Rua Turiaçu",\n    "endereco_numero": "271",\n    "bairro": "São José dos Campos",\n    "complemento": "1235",\n    "estado": "EX",\n    "cidade": "",\n    "cep": "",\n    "codigo_pais": "2496",\n    "separar_endereco": "",\n    "pesquisar_cep": "",\n    "telefone2_ddd": "",\n    "telefone2_numero": "",\n    "fax_ddd": "",\n    "fax_numero": "",\n    "email": "mirian@oondemand.com.br",\n    "homepage": "",\n    "inscricao_estadual": "",\n    "inscricao_municipal": "",\n    "inscricao_suframa": "",\n    "optante_simples_nacional": "",\n    "tipo_atividade": "",\n    "cnae": "",\n    "produtor_rural": "",\n    "contribuinte": "",\n    "observacao": "",\n    "obs_detalhadas": "",\n    "recomendacao_atraso": "",\n    "tags": [\n      {\n        "tag": "Fornecedor"\n      }\n    ],\n    "pessoa_fisica": "N",\n    "exterior": "S",\n    "logradouro": "",\n    "importado_api": "",\n    "bloqueado": "N",\n    "cidade_ibge": "",\n    "valor_limite_credito": 0,\n    "bloquear_faturamento": "N",\n    "recomendacoes": {\n      "gerar_boletos": "N"\n    },\n    "enderecoEntrega": {},\n    "nif": "",\n    "documento_exterior": "",\n    "inativo": "N",\n    "dadosBancarios": {\n      "agencia": "",\n      "cChavePix": "",\n      "codigo_banco": "",\n      "conta_corrente": "",\n      "doc_titular": "",\n      "nome_titular": "",\n      "transf_padrao": "N"\n    },\n    "caracteristicas": [],\n    "enviar_anexos": "",\n    "info": {\n      "cImpAPI": "S",\n      "dAlt": "18/11/2024",\n      "dInc": "18/09/2024",\n      "hAlt": "14:09:41",\n      "hInc": "15:34:12",\n      "uAlt": "P000875035",\n      "uInc": "WEBSERVICE"\n    },\n    "bloquear_exclusao": "N",\n    "pais": "Estados Unidos"\n  }\n}',
  },
];

const gerarConfiguracoesPadrao = async ({ tenantId }) => {
  try {
    const baseOmie = new BaseOmie({ ...defaultBaseOmie, tenant: tenantId });
    await baseOmie.save();

    defaultConfigs.forEach((config) => {
      const newConfig = new Configuracoes({ ...config, tenant: tenantId });
      newConfig.save();
    });

    defaultMoedas.forEach((moeda) => {
      const newMoeda = new Moeda({ ...moeda, tenant: tenantId });
      newMoeda.save();
    });

    defaultTemplates.forEach((template) => {
      const newTemplate = new Template({ ...template, tenant: tenantId });
      newTemplate.save();
    });

    defaultIncludes.forEach((include) => {
      const newInclude = new Include({ ...include, tenant: tenantId });
      newInclude.save();
    });

    console.log("Configurações padrão criadas!");
  } catch (error) {
    console.log(error);
  }
};

exports.seedUtils = {
  gerarConfiguracoesPadrao,
};
